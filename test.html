<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>不锈钢牌号查询工作站 - 功能测试</h1>
    
    <div class="test-section">
        <h2>1. 数据扩展测试</h2>
        <button onclick="testExtendedData()">测试扩展数据</button>
        <div id="extended-data-result"></div>
    </div>

    <div class="test-section">
        <h2>2. 访问统计测试</h2>
        <button onclick="testAnalytics()">测试访问统计</button>
        <div id="analytics-result"></div>
    </div>

    <div class="test-section">
        <h2>3. 搜索功能测试</h2>
        <button onclick="testSearch()">测试搜索功能</button>
        <div id="search-result"></div>
    </div>

    <div class="test-section">
        <h2>4. 高级过滤测试</h2>
        <button onclick="testAdvancedFilters()">测试高级过滤</button>
        <div id="advanced-filters-result"></div>
    </div>

    <script>
        // 模拟数据库
        const DB = {
            gb: {
                "12Cr18Ni9": {
                    standard: "GB/T 20878",
                    uns: "S30200",
                    series: "300系列",
                    type: "austenitic",
                    family: "chromium-nickel",
                    yield_strength: 205,
                    tensile_strength: 520,
                    cr: "17.0-19.0",
                    ni: "8.0-10.0"
                }
            },
            astm: {
                "17-4PH": {
                    standard: "ASTM A240/A240M",
                    uns: "S17400",
                    series: "沉淀硬化系列",
                    type: "precipitation-hardening",
                    family: "chromium-nickel-copper",
                    yield_strength: 1170,
                    tensile_strength: 1310,
                    cr: "15.0-17.5",
                    ni: "3.0-5.0",
                    cu: "3.0-5.0",
                    nb: "0.15-0.45"
                }
            },
            nickel: {
                "Inconel 600": {
                    standard: "ASTM B168",
                    uns: "N06600",
                    series: "镍基合金",
                    type: "nickel-chromium",
                    family: "nickel-based",
                    yield_strength: 240,
                    tensile_strength: 550,
                    ni: "≥72.0",
                    cr: "14.0-17.0",
                    fe: "6.0-10.0"
                }
            }
        };

        function testExtendedData() {
            const result = document.getElementById('extended-data-result');
            try {
                // 检查扩展数据是否存在
                const hasExtendedData = DB.gb["12Cr18Ni9"] && DB.astm["17-4PH"] && DB.nickel["Inconel 600"];
                
                if (hasExtendedData) {
                    result.innerHTML = `
                        <div class="test-result success">
                            ✅ 扩展数据加载成功<br>
                            - GB标准: ${Object.keys(DB.gb).length} 个牌号<br>
                            - ASTM标准: ${Object.keys(DB.astm).length} 个牌号<br>
                            - 镍基合金: ${Object.keys(DB.nickel).length} 个牌号<br>
                            - 沉淀硬化不锈钢: 已添加<br>
                            - 镍基合金: 已添加
                        </div>
                    `;
                } else {
                    throw new Error('扩展数据未正确加载');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        ❌ 扩展数据测试失败: ${error.message}
                    </div>
                `;
            }
        }

        function testAnalytics() {
            const result = document.getElementById('analytics-result');
            try {
                // 模拟访问统计功能
                const analytics = {
                    totalVisits: 1,
                    dailyVisits: {
                        [new Date().toISOString().split('T')[0]]: {
                            count: 1,
                            uniqueIPs: ['127.0.0.1'],
                            visitors: [{
                                ip: '127.0.0.1',
                                timestamp: new Date().toISOString(),
                                date: new Date().toISOString().split('T')[0]
                            }]
                        }
                    }
                };
                
                localStorage.setItem('analytics', JSON.stringify(analytics));
                
                result.innerHTML = `
                    <div class="test-result success">
                        ✅ 访问统计功能正常<br>
                        - 今日访问量: ${analytics.dailyVisits[Object.keys(analytics.dailyVisits)[0]].count}<br>
                        - 独立访客: ${analytics.dailyVisits[Object.keys(analytics.dailyVisits)[0]].uniqueIPs.length}<br>
                        - 总访问量: ${analytics.totalVisits}<br>
                        - 数据已保存到localStorage
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        ❌ 访问统计测试失败: ${error.message}
                    </div>
                `;
            }
        }

        function testSearch() {
            const result = document.getElementById('search-result');
            try {
                // 测试搜索功能
                const searchQuery = "17-4PH";
                const searchResults = [];
                
                Object.keys(DB).forEach(standard => {
                    Object.keys(DB[standard]).forEach(grade => {
                        if (grade.toLowerCase().includes(searchQuery.toLowerCase()) ||
                            DB[standard][grade].uns.toLowerCase().includes(searchQuery.toLowerCase())) {
                            searchResults.push({
                                name: grade,
                                standard: standard.toUpperCase(),
                                ...DB[standard][grade]
                            });
                        }
                    });
                });
                
                if (searchResults.length > 0) {
                    result.innerHTML = `
                        <div class="test-result success">
                            ✅ 搜索功能正常<br>
                            搜索 "${searchQuery}" 找到 ${searchResults.length} 个结果:<br>
                            ${searchResults.map(item => `- ${item.name} (${item.standard})`).join('<br>')}
                        </div>
                    `;
                } else {
                    throw new Error('未找到搜索结果');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        ❌ 搜索功能测试失败: ${error.message}
                    </div>
                `;
            }
        }

        function testAdvancedFilters() {
            const result = document.getElementById('advanced-filters-result');
            try {
                // 测试高级过滤功能
                const filters = {
                    standard: 'ASTM',
                    type: 'precipitation-hardening',
                    hasCopper: true
                };
                
                let filteredData = [];
                Object.keys(DB).forEach(standard => {
                    Object.keys(DB[standard]).forEach(grade => {
                        const item = DB[standard][grade];
                        let matches = true;
                        
                        if (filters.standard && standard.toUpperCase() !== filters.standard) {
                            matches = false;
                        }
                        
                        if (filters.type && item.type !== filters.type) {
                            matches = false;
                        }
                        
                        if (filters.hasCopper && (!item.cu || item.cu === '—')) {
                            matches = false;
                        }
                        
                        if (matches) {
                            filteredData.push({
                                name: grade,
                                standard: standard.toUpperCase(),
                                ...item
                            });
                        }
                    });
                });
                
                if (filteredData.length > 0) {
                    result.innerHTML = `
                        <div class="test-result success">
                            ✅ 高级过滤功能正常<br>
                            过滤条件: ASTM标准 + 沉淀硬化 + 含铜<br>
                            找到 ${filteredData.length} 个结果:<br>
                            ${filteredData.map(item => `- ${item.name} (${item.standard})`).join('<br>')}
                        </div>
                    `;
                } else {
                    throw new Error('过滤后无结果');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        ❌ 高级过滤测试失败: ${error.message}
                    </div>
                `;
            }
        }

        // 页面加载完成后自动运行所有测试
        window.addEventListener('load', () => {
            setTimeout(() => {
                testExtendedData();
                testAnalytics();
                testSearch();
                testAdvancedFilters();
            }, 1000);
        });
    </script>
</body>
</html> 